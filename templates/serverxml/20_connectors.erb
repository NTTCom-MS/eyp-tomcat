
  <Service name="Catalina">

    <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"
            maxThreads="<%= @max_threads %>" minSpareThreads="<%= @min_spare_threads %>"/>

  <%- if @connector_http_enabled -%>
  <%- if defined?(@connector_port) -%>
    <Connector port="<%= @connector_port %>"
               protocol="HTTP/1.1"
               executor="tomcatThreadPool"
               enableLookups="<%= @connector_http_enable_lookups %>"
               disableUploadTimeout="<%= @connector_http_disable_upload_timeout %>"
               <%- if defined?(@connector_http_server) -%>
               server="<%= @connector_http_server %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_header_size) -%>
               maxHttpHeaderSize="<%= @connector_http_max_header_size %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_threads) -%>
               maxThreads="<%= @connector_http_max_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_min_spare_threads) -%>
               minSpareThreads="<%= @connector_http_min_spare_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_spare_threads) -%>
               maxSpareThreads="<%= @connector_http_max_spare_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_accept_count) -%>
               acceptCount="<%= @connector_http_accept_count %>"
               <%- end -%>
               <%- if defined?(@connector_http_connection_timeout) -%>
               connectionTimeout="<%= @connector_http_connection_timeout %>"
               <%- end -%>
               <%- if defined?(@connector_http_uri_encoding) -%>
               URIEncoding="<%= @connector_http_uri_encoding %>"
               <%- end -%>
               redirectPort="<%= @redirect_port %>" />
  <%- end -%>
  <%- end -%>

  <% if defined?(@ajp_port) -%>
  <% if ! @ajp_port.to_s.empty? -%>
    <!-- Define an AJP 1.3 Connector on port 8009 -->
    <Connector port="<%= @ajp_port %>"
               protocol="AJP/1.3"
               <%- if defined?(@connector_ajp_packet_size) -%>
               packetSize="<%= @connector_ajp_packet_size %>"
               <%- end -%>
               <%- if defined?(@connector_ajp_max_threads) -%>
               connector_ajp_max_threads="<%= @connector_ajp_max_threads %>"
               <%- end -%>
               redirectPort="<%= @redirectPort %>" />
      <% end -%>
  <% end -%>

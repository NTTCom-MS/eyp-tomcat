
  <Service name="Catalina">

    <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"
            maxThreads="<%= @max_threads %>" minSpareThreads="<%= @min_spare_threads %>"/>

  <%- if @connector_https_enabled -%>
    <!-- HTTPS Connector -->
    <Connector  port="<%= @connector_https_port %>"
                protocol="HTTP/1.1"
                SSLEnabled="true"
                <%- if defined?(@connector_https_server) -%>
                server="<%= @connector_https_server %>"
                <%- end -%>
                <%- if defined?(@connector_https_max_header_size) -%>
                maxHttpHeaderSize="<%= @connector_https_max_header_size %>"
                <%- end -%>
                <%- if defined?(@connector_https_max_threads) -%>
                maxThreads="<%= @connector_https_max_threads %>"
                <%- end -%>
                <%- if defined?(@connector_https_min_spare_threads) -%>
                minSpareThreads="<%= @connector_https_min_spare_threads %>"
                <%- end -%>
                <%- if defined?(@connector_https_max_spare_threads) -%>
                maxSpareThreads="<%= @connector_https_max_spare_threads %>"
                <%- end -%>
                <%- if defined?(@connector_https_accept_count) -%>
                acceptCount="<%= @connector_https_accept_count %>"
                <%- end -%>
                <%- if defined?(@connector_https_connection_timeout) -%>
                connectionTimeout="<%= @connector_https_connection_timeout %>"
                <%- end -%>
                scheme="https"
                secure="true"
                <%- if defined?(@connector_https_thruststore) -%>
                truststoreFile="<%= @connector_https_thruststore %>"
                truststorePass="<%= @connector_https_thruststore_pass %>"
                <%- end -%>
                <%- if defined?(@connector_https_keystore) -%>
                keystoreFile="<%= @connector_https_keystore %>"
                keystorePass="<%= @connector_https_keystore_pass %>"
                <%- end -%>
                <%- if defined?(@connector_https_client_auth) -%>
                clientAuth="<%= @connector_https_client_auth %>"
                <%- end -%>
                sslProtocol="<%= @connector_https_sslprotocol %>" />
  <%- end -%>

  <%- if @connector_http_enabled -%>
  <%- if defined?(@connector_port) -%>
    <!-- HTTP Connector -->
    <Connector port="<%= @connector_port %>"
               protocol="HTTP/1.1"
               executor="tomcatThreadPool"
               enableLookups="<%= @connector_http_enable_lookups %>"
               disableUploadTimeout="<%= @connector_http_disable_upload_timeout %>"
               <%- if defined?(@connector_http_server) -%>
               server="<%= @connector_http_server %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_header_size) -%>
               maxHttpHeaderSize="<%= @connector_http_max_header_size %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_threads) -%>
               maxThreads="<%= @connector_http_max_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_min_spare_threads) -%>
               minSpareThreads="<%= @connector_http_min_spare_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_max_spare_threads) -%>
               maxSpareThreads="<%= @connector_http_max_spare_threads %>"
               <%- end -%>
               <%- if defined?(@connector_http_accept_count) -%>
               acceptCount="<%= @connector_http_accept_count %>"
               <%- end -%>
               <%- if defined?(@connector_http_connection_timeout) -%>
               connectionTimeout="<%= @connector_http_connection_timeout %>"
               <%- end -%>
               <%- if defined?(@connector_http_uri_encoding) -%>
               URIEncoding="<%= @connector_http_uri_encoding %>"
               <%- end -%>
               redirectPort="<%= @redirect_port %>" />
  <%- end -%>
  <%- end -%>

  <% if defined?(@ajp_port) -%>
  <% if ! @ajp_port.to_s.empty? -%>
    <!-- AJP Connector -->
    <Connector port="<%= @ajp_port %>"
               protocol="AJP/1.3"
               <%- if defined?(@connector_ajp_packet_size) -%>
               packetSize="<%= @connector_ajp_packet_size %>"
               <%- end -%>
               <%- if defined?(@connector_ajp_max_threads) -%>
               maxThreads="<%= @connector_ajp_max_threads %>"
               <%- end -%>
               <%- if defined?(@connector_ajp_accept_count) -%>
               acceptCount="<%= @connector_ajp_accept_count %>"
               <%- end -%>
               <%- if defined?(@connector_ajp_acceptor_threadcount) -%>
               acceptorThreadCount="<%= @connector_ajp_acceptor_threadcount %>"
               <%- end -%>
               <%- if defined?(@connector_ajp_connection_timeout) -%>
               connectionTimeout="<%= @connector_ajp_connection_timeout %>"
               <%- end -%>
               redirectPort="<%= @redirectPort %>" />
      <% end -%>
  <% end -%>
